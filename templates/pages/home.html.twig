{% extends 'base.html.twig' %}

{% block body %}
    <div class="page-home">
        <div id="map" style="width: 800px; height: 600px;"></div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/lib/leaflet/leaflet.js') }}"></script>
    <script src="{{ asset('assets/lib/cluster/leaflet.markercluster.js') }}"></script>
    <script src="{{ asset('assets/lib/Leaflet.Photo.js') }}"></script>
    <script type="application/javascript">
      var map = L.map('map').setView([47.2096141132971, -1.5327856003723355], 12);

      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
        id: 'mapbox.streets'
      }).addTo(map);

      var photoLayer = L.photo.cluster().on('click', function (evt) {
        var photo = evt.layer.photo,
          template = '<img src="{url}"/></a><p>{caption}</p>';

        evt.layer.bindPopup(L.Util.template(template, evt.layer.photo), {
          className: 'leaflet-popup-photo',
          minWidth: 400
        }).openPopup();
      });

      function showImages() {
        var datas = '[{"id": "1", "timestamp": "1524862300", "lat": "47.2046278293756", "lng": "-1.5627931420681307", "url": "/img/P1030409.jpg", "caption": "plop1", "iconUrl": "/img/P1030409.jpg", "thumbnail": "/img/P1030409.jpg"},' +
          '{"id": "2", "timestamp": "1524862300", "lat": "47.1995894480958", "lng": "-1.580989248025162", "url": "/img/P1030410.jpg", "caption": "plop2", "iconUrl": "/img/P1030410.jpg", "thumbnail": "/img/P1030410.jpg"},' +
          '{"id": "3", "timestamp": "1524862300", "lat": "47.181753000672344", "lng": "-1.525456792580826", "url": "/img/P1030414.jpg", "caption": "plop3", "iconUrl": "/img/P1030414.jpg", "thumbnail": "/img/P1030414.jpg"}]';
        var photos = [];
        var data = JSON.parse(datas);
        for (var i = 0; i < data.length; i++) {
          var photo = data[i];
          console.log(photo);
          photos.push({
            id: photo.id,
            timestamp: parseInt(photo.timestamp),
            lat: parseFloat(photo.lat),
            lng: parseFloat(photo.lng),
            url: photo.url,
            caption: photo.caption,
            iconUrl: photo.iconUrl
          });
        }
        photoLayer.add(photos).addTo(map);
        map.fitBounds(photoLayer.getBounds());
      }
    </script>
{% endblock %}