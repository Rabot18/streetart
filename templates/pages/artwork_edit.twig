{% extends 'base.html.twig' %}

{% set isCreateForm = form.vars.data.id|default(false) ? false : true %}

{% form_theme form _self %}

{% block choice_widget_expanded -%}
    <style>
        .searchable-container .btn{display: block;margin: 0;padding: 2px 5px;width:105px;height:78px;}
        .searchable-container .btn span.fa-check{opacity: 0;}
        .searchable-container .btn.active span.fa-check {opacity: 1;}
        .searchable-container input[type="checkbox"] {
            clip: rect(0,0,0,0);
            position: absolute;
        }
    </style>
    <div class="form-group">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <input type="search" class="form-control" id="search-artist" placeholder="Search an artist">
        </div>
    </div>
    <div {{ block('widget_container_attributes') }} class="searchable-container">
            {%- for child in form %}
                {#{{ dump(child) }}#}
                {% set entity = form.vars.choices[loop.index].data %}
                {{- form_widget(child, {'entity': entity}) -}}
                {{- form_label(child, null, {translation_domain: choice_translation_domain}) -}}
            {% endfor -%}
    </div>
{%- endblock choice_widget_expanded %}

{% block checkbox_widget -%}
    {%- set attr = attr|merge({class: (attr.class|default('') ~ ' form-check-input')|trim}) -%}
    {% if entity.avatarName is empty %}
        {% set imgSrc = asset('assets/img/author-avatar.jpg') %}
    {% else %}
        {% set imgSrc = vich_uploader_asset(entity, 'avatarFile') %}
    {% endif %}
    {#<div class="form-check d-inline-block items" style="width:105px;height:78px;background: url('{{ imgSrc | imagine_filter('thumb_smaller') }}') no-repeat;margin:5px 7px;">#}
        {#<input type="checkbox" {{ block('widget_attributes') }}{% if value is defined %} value="{{ value }}"{% endif %}{% if checked %} checked="checked"{% endif %} autocomplete="off" />#}
        {#<span class="glyphicon glyphicon-ok glyphicon-lg"></span>#}
        {#{% if label is not same as(false) -%}#}
            {#{%- if compound is defined and compound -%}#}
                {#{%- set element = 'legend' -%}#}
                {#{%- set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' col-form-label')|trim}) -%}#}
            {#{%- else -%}#}
                {#{%- set label_attr = label_attr|merge({for: id}) -%}#}
            {#{%- endif -%}#}
            {#{% if required -%}#}
                {#{% set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' required')|trim}) %}#}
            {#{%- endif -%}#}
            {#{% if label is empty -%}#}
                {#{%- if label_format is not empty -%}#}
                    {#{% set label = label_format|replace({#}
                        {#'%name%': name,#}
                        {#'%id%': id,#}
                    {#}) %}#}
                {#{%- else -%}#}
                    {#{% set label = name|humanize %}#}
                {#{%- endif -%}#}
            {#{%- endif -%}#}
            {#<{{ element|default('label') }}{% if label_attr %}{% with { attr: label_attr } %}{{ block('attributes') }}{% endwith %}{% endif %}>{{ translation_domain is same as(false) ? label : label|trans({}, translation_domain) }}{% block form_label_errors %}{{- form_errors(form) -}}{% endblock form_label_errors %}</{{ element|default('label') }}>#}
        {#{%- else -%}#}
            {#{%- if errors|length > 0 -%}#}
                {#<div id="{{ id }}_errors" class="mb-2">#}
                    {#{{- form_errors(form) -}}#}
                {#</div>#}
            {#{%- endif -%}#}
        {#{%- endif -%}#}
    {#</div>#}
    <div class="items d-inline-block" style="width:105px;height:78px;background: url('{{ imgSrc | imagine_filter('thumb_smaller') }}') no-repeat;margin:5px 7px;">
        <div class="info-block block-info clearfix">
            <div data-toggle="buttons">
                <label class="btn">
                    <input type="checkbox" name="var_id[]" autocomplete="off" value="">
                    <span class="fas fa-check"></span>
                    <h5>{{ entity.name }}</h5>
                </label>
            </div>
        </div>
    </div>
{%- endblock checkbox_widget %}

{% block success %}
    <div class="content-success text-center mt-5">

        <figure class="">
            <i class="far fa-check-circle content-success-icon"></i>
        </figure>

        <h3 class="card-title">
            {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                {{ 'artwork.message.wording_success'|transchoice(1, {'username' : user.username})|raw }}
            {% else %}
                {{ 'artwork.message.wording_success'|transchoice(0, {'username' : 0})|raw }}
                <br><br><a href="{{ path('welcome') }}"><strong>{{ 'artwork.login'|trans({}) }}</strong></a>
            {% endif %}
        </h3>

        <a href="{{ path('app_artwork_new') }}"
           class="btn btn-lg btn-primary mt-4">{{ 'artwork.button.add_new'|trans({}, 'messages') }}</a>
    </div>
{% endblock %}

{% block form %}
    <h2 class="card-title mb-4 text-center">
        {% if isCreateForm %}
            {{ 'artwork.title.create'|trans({}, 'messages') }}
        {% else %}
            {{ 'artwork.title.edit'|trans({}, 'messages') }}
        {% endif %}
    </h2>
    <div class="row">
        <div class="col-12">
            <p>
                {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                    {{ 'artwork.connected'|trans({'username' : user.username}) }}
                {% else %}
                    <a href="{{ path('welcome') }}"><strong>{{ 'artwork.login'|trans({}) }}</strong></a>
                {% endif %}
            </p>
            {{ 'artwork.introduction'|trans({}, 'messages')|raw }}
            <hr />
        </div>
    </div>

    {{ form_start(form, { attr: { novalidate: 'novalidate' }}) }}
    {{ form_errors(form) }}

    <label class="d-flex justify-content-between align-items-center">
        {{ form.documents.vars.label|trans }}
        <a href="#"
           class="add-document-link btn btn-sm btn-info">{{ 'artwork.link.add_a_document'|trans({}, 'messages') }}</a>
    </label>
    {{ form_widget(form.documents) }}

    <hr />

    {{ form_row(form.title, { 'attr': {'placeholder' : 'La Fabrique'}}) }}
    {{ form_row(form.poi.address, { 'attr': {'placeholder' : '8 Boulevard LÃ©on Bureau, 44200 Nantes, France'}}) }}

    <div class="row">
        <div class="col-6">
            {{ form_row(form.poi.city, { 'attr': {'placeholder' : 'Nantes'}}) }}
        </div>
        <div class="col-6">
            {{ form_row(form.poi.country, { 'attr': {'placeholder' : 'France'}}) }}
        </div>
    </div>

    <div class="row">
        <div class="col-6">
            {{ form_row(form.poi.latitude, { 'attr': {'placeholder' : '47.204696'}}) }}
        </div>
        <div class="col-6">
            {{ form_row(form.poi.longitude, { 'attr': {'placeholder' : '-1.562808'}}) }}
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            {{ form_row(form.author) }}
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="{{ app.request.uri }}"
           class="btn btn-lg btn btn-outline-dark mr-2">{{ 'artwork.button.cancel'|trans({}, 'messages') }}</a>

        <button type="submit"
                class="btn btn-lg btn-primary">{{ 'artwork.button.save'|trans({}, 'messages') }}</button>
    </div>

    {{ form_rest(form) }}
    {{ form_end(form) }}
{% endblock %}

{% block body %}
    <div class="page-artwork-edit">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-12">
                    <div class="card mt-5">
                        <article class="card-body p-5">
                            {% if app.request.get('success', false) %}
                                {{ block('success') }}
                            {% else %}
                                {{ block('form') }}
                            {% endif %}
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block _artwork_documents_entry_row %}
    {% set document = form.vars.data %}

    <div class="item-document">
        {{ form_widget(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        const translations = {
            'delete' : '{{ 'artwork.label.delete' | trans }}',
        }
    </script>
    <script src="{{ asset('build/js/artwork-edit.js') }}"></script>
{% endblock %}